/**
 * @type {heap}
 */
module.exports = heap;
/**
 * heap
 * @param compare
 * @returns {{}}
 */
function heap(compare) {
	var  heap  = {};
	var  array = [];
	var  size  = 0;

	heap.size = function() {
		return size;
	};

	heap.push = function(object) {
		up(array[size] = object, size++);
		return size;
	};

	heap.pop = function() {
		if(size <= 0) {
			return;
		}
		var removed = array[0], object;
		if(--size > 0) {
			object = array[size];
			down(array[0] = object, 0);
		}
		return removed;
	};

	function up(object, i) {
		while(i > 0) {
			var j      = ((i + 1) >> 1) - 1,
			    parent = array[j];
			if(compare(object, parent) >= 0) {
				break;
			}
			array[i]     = parent;
			array[i = j] = object;
		}
	}

	function down(object, i) {
		while(true) {
			var r     = (i + 1) << 1,
			    l     = r - 1,
			    j     = i,
			    child = array[j];
			if(l < size && compare(array[l], child) < 0) {
				child = array[j = l];
			}
			if(r < size && compare(array[r], child) < 0) {
				child = array[j = r];
			}
			if(j === i) {
				break;
			}
			array[i]     = child;
			array[i = j] = object;
		}
	}

	return heap;
}
